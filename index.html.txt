<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trip & Enjoy - Portal de Viajes</title>
    <link rel="icon" href="https://i.postimg.cc/WNbxj55s/Favicon-T-E-(2).png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
const {useState,useEffect}=React;
const {createClient}=supabase;

const SUPABASE_URL='https://txmfjhhjyjjktgluyjzj.supabase.co';
const SUPABASE_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR4bWZqaGhqeWpqa3RnbHV5anpqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgwNzU4ODEsImV4cCI6MjA4MzY1MTg4MX0.Qab1gujJBQDfOxeuP5v5pWYO-x5ARGiOkgTaF5aeVyk';
const sb=createClient(SUPABASE_URL,SUPABASE_KEY);
const ADMIN_PASS='tripnenjoy2025';

const App=()=>{
const[trips,setTrips]=useState([]);
const[code,setCode]=useState('');
const[curr,setCurr]=useState(null);
const[admin,setAdmin]=useState(false);
const[pass,setPass]=useState('');
const[auth,setAuth]=useState(false);
const[logo,setLogo]=useState('https://i.postimg.cc/WNbxj55s/Favicon-T-E-(2).png');
const[newCode,setNewCode]=useState('');
const[editInfo,setEditInfo]=useState(false);
const[loading,setLoading]=useState(true);
const[docs,setDocs]=useState([]);

const cats={
aereos:{n:'Vuelos',i:'âœˆï¸',c:'bg-blue-500'},
hoteles:{n:'Hoteles',i:'ğŸ¨',c:'bg-purple-500'},
transportes:{n:'Transportes',i:'ğŸš—',c:'bg-green-500'},
traslados:{n:'Traslados',i:'ğŸ“',c:'bg-orange-500'},
actividades:{n:'Actividades',i:'ğŸ§­',c:'bg-pink-500'},
circuitos:{n:'Circuitos',i:'ğŸ—ºï¸',c:'bg-indigo-500'},
seguroMedico:{n:'Seguro',i:'ğŸ›¡ï¸',c:'bg-red-500'},
otros:{n:'Otros',i:'ğŸ“„',c:'bg-gray-500'}
};

const loadTrips=async()=>{
setLoading(true);
const{data}=await sb.from('trips').select('*').order('created_at',{ascending:false});
setTrips(data||[]);
setLoading(false);
};

const loadDocs=async(tripId)=>{
const{data}=await sb.from('documents').select('*').eq('trip_id',tripId);
setDocs(data||[]);
};

const loadLogo=async()=>{
const{data}=await sb.from('config').select('value').eq('key','logo').single();
if(data)setLogo(data.value);
};

useEffect(()=>{loadTrips();loadLogo()},[]);

const access=()=>{
const c=code.toUpperCase().trim();
const trip=trips.find(t=>t.code===c);
if(trip){setCurr(trip);setCode('');loadDocs(trip.id)}else alert('CÃ³digo invÃ¡lido');
};

const login=()=>{if(pass===ADMIN_PASS){setAuth(true);setPass('')}else alert('ContraseÃ±a incorrecta')};

const create=async()=>{
const c=newCode.toUpperCase().trim();
if(!c){alert('Ingresa cÃ³digo');return}
if(trips.find(t=>t.code===c)){alert('Ya existe');return}
const{data,error}=await sb.from('trips').insert([{code:c,destination:'',start_date:null,end_date:null,passenger_name:''}]).select().single();
if(error){alert('Error: '+error.message);return}
await loadTrips();
setCurr(data);
loadDocs(data.id);
setNewCode('');
};

const updateTrip=async(field,value)=>{
await sb.from('trips').update({[field]:value}).eq('id',curr.id);
await loadTrips();
const updated=trips.find(t=>t.id===curr.id);
if(updated)setCurr(updated);
};

const delTrip=async(id,c)=>{
if(!confirm(`Â¿Eliminar ${c}?`))return;
await sb.from('trips').delete().eq('id',id);
await loadTrips();
if(curr?.id===id)setCurr(null);
};

const upLogo=async(e)=>{
const f=e.target.files[0];
if(!f)return;
const r=new FileReader();
r.onload=async(ev)=>{
await sb.from('config').update({value:ev.target.result}).eq('key','logo');
setLogo(ev.target.result);
};
r.readAsDataURL(f);
};

const upFile=async(e,cat)=>{
const fs=Array.from(e.target.files);
for(const f of fs){
const r=new FileReader();
r.onload=async(ev)=>{
await sb.from('documents').insert([{
trip_id:curr.id,
category:cat,
display_name:f.name.replace('.pdf',''),
file_name:f.name,
file_data:ev.target.result
}]);
await loadDocs(curr.id);
};
r.readAsDataURL(f);
}
};

const delDoc=async(id)=>{
if(!confirm('Â¿Eliminar?'))return;
await sb.from('documents').delete().eq('id',id);
await loadDocs(curr.id);
};

const download=(d)=>{
const l=document.createElement('a');
l.href=d.file_data;
l.download=d.file_name;
l.click();
};

const downloadAll=()=>{
let t=0;
docs.forEach(d=>{setTimeout(()=>download(d),t);t+=300});
};

const fmt=d=>d?new Date(d).toLocaleDateString('es-ES',{day:'2-digit',month:'short',year:'numeric'}):'';

const getDocsByCat=(cat)=>docs.filter(d=>d.category===cat);

if(loading)return(
<div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center">
<div className="text-center">
<div className="text-6xl mb-4">â³</div>
<p className="text-xl text-gray-600">Cargando...</p>
</div>
</div>
);

if(!curr&&!admin)return(
<div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-6">
<div className="max-w-md w-full">
<div className="bg-white rounded-lg shadow-2xl p-8">
<div className="text-center mb-8">
<img src={logo} className="h-24 w-24 mx-auto mb-4 object-contain"/>
<h1 className="text-3xl font-bold mb-2">Trip & Enjoy</h1>
<p className="text-gray-600">Portal de Documentos</p>
</div>
<div className="space-y-4">
<input type="text" value={code} onChange={e=>setCode(e.target.value.toUpperCase())} onKeyPress={e=>e.key==='Enter'&&access()} placeholder="CÃ“DIGO DEL VIAJE" className="w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:border-blue-500 text-center text-lg font-bold uppercase"/>
<button onClick={access} className="w-full px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-bold">ğŸ”‘ Acceder</button>
<button onClick={()=>setAdmin(true)} className="w-full px-6 py-3 bg-gray-200 rounded-lg hover:bg-gray-300 text-sm">Admin</button>
</div>
</div>
<div className="mt-6 bg-white rounded-lg shadow-lg p-6 text-center">
<p className="text-gray-600 mb-4 text-sm font-medium">Seguinos</p>
<div className="flex justify-center gap-4">
<a href="https://instagram.com/tripnenjoy" target="_blank" className="flex items-center gap-2 px-3 py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg text-sm hover:from-purple-600">
<svg className="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
@tripnenjoy
</a>
<a href="https://wa.me/5491126092015" target="_blank" className="flex items-center gap-2 px-3 py-2 bg-green-500 text-white rounded-lg text-sm hover:bg-green-600">
<svg className="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/></svg>
WhatsApp
</a>
</div>
</div>
</div>
</div>
);

if(admin&&!auth)return(
<div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-6">
<div className="max-w-md w-full bg-white rounded-lg shadow-2xl p-8">
<h2 className="text-2xl font-bold text-center mb-6">Admin</h2>
<input type="password" value={pass} onChange={e=>setPass(e.target.value)} onKeyPress={e=>e.key==='Enter'&&login()} placeholder="ContraseÃ±a" className="w-full px-4 py-3 border-2 rounded-lg mb-4"/>
<button onClick={login} className="w-full px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 mb-3">Entrar</button>
<button onClick={()=>setAdmin(false)} className="w-full px-6 py-3 bg-gray-200 rounded-lg">Volver</button>
</div>
</div>
);

if(auth){
return(
<div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6">
<div className="max-w-6xl mx-auto">
<div className="bg-white rounded-lg shadow-lg p-6 mb-6">
<div className="flex justify-between items-center mb-6">
<h1 className="text-2xl font-bold">Panel Admin</h1>
<button onClick={()=>{setAuth(false);setAdmin(false);setCurr(null)}} className="px-4 py-2 bg-gray-600 text-white rounded-lg">Salir</button>
</div>

<div className="border rounded-lg p-4 mb-6">
<h3 className="text-lg font-semibold mb-3">ğŸ“¤ Logo</h3>
<input type="file" accept="image/*" onChange={upLogo} className="block w-full text-sm file:py-2 file:px-4 file:rounded-lg file:border-0 file:bg-blue-50 file:text-blue-700"/>
<img src={logo} className="h-16 w-16 mt-3 border rounded"/>
</div>

<div className="border rounded-lg p-4 mb-6">
<h3 className="text-lg font-semibold mb-3">â• Crear Viaje</h3>
<div className="flex gap-3">
<input type="text" value={newCode} onChange={e=>setNewCode(e.target.value.toUpperCase())} onKeyPress={e=>e.key==='Enter'&&create()} placeholder="CÃ“DIGO" className="flex-1 px-3 py-2 border rounded uppercase font-bold"/>
<button onClick={create} className="px-6 py-2 bg-green-600 text-white rounded-lg">Crear</button>
</div>
</div>

<div className="border rounded-lg p-4 mb-6">
<h3 className="text-lg font-semibold mb-3">Viajes ({trips.length})</h3>
<div className="space-y-2">
{trips.map(t=>(
<div key={t.id} className="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
<div className="flex items-center gap-3">
<span className="font-mono font-bold text-lg">{t.code}</span>
{t.destination&&<span className="text-sm text-gray-600">â†’ {t.destination}</span>}
</div>
<div className="flex gap-2">
<button onClick={()=>{setCurr(t);loadDocs(t.id)}} className={`px-4 py-2 rounded-lg ${curr?.id===t.id?'bg-blue-600 text-white':'bg-blue-100 text-blue-700'}`}>{curr?.id===t.id?'Editando':'Editar'}</button>
<button onClick={()=>delTrip(t.id,t.code)} className="px-3 py-2 bg-red-100 text-red-700 rounded-lg">ğŸ—‘ï¸</button>
</div>
</div>
))}
{!trips.length&&<p className="text-center text-gray-500 py-4">Sin viajes</p>}
</div>
</div>
</div>

{curr&&(
<div className="bg-white rounded-lg shadow-lg p-6">
<div className="flex justify-between items-center mb-4">
<h2 className="text-xl font-bold">Editando: {curr.code}</h2>
<button onClick={()=>setEditInfo(!editInfo)} className="text-blue-600">âœï¸ Info</button>
</div>

{editInfo&&(
<div className="border rounded-lg p-4 mb-6 space-y-3">
<input type="text" placeholder="Nombre pasajero" value={curr.passenger_name||''} onChange={e=>updateTrip('passenger_name',e.target.value)} className="w-full px-3 py-2 border rounded"/>
<input type="text" placeholder="Destino" value={curr.destination||''} onChange={e=>updateTrip('destination',e.target.value)} className="w-full px-3 py-2 border rounded"/>
<div className="grid grid-cols-2 gap-3">
<input type="date" value={curr.start_date||''} onChange={e=>updateTrip('start_date',e.target.value)} className="px-3 py-2 border rounded"/>
<input type="date" value={curr.end_date||''} onChange={e=>updateTrip('end_date',e.target.value)} className="px-3 py-2 border rounded"/>
</div>
<button onClick={()=>setEditInfo(false)} className="px-4 py-2 bg-green-600 text-white rounded-lg">Cerrar</button>
</div>
)}

<div className="space-y-6">
{Object.keys(cats).map(k=>{
const catDocs=getDocsByCat(k);
return(
<div key={k} className="border rounded-lg p-4">
<div className="flex items-center gap-3 mb-3">
<div className={`${cats[k].c} p-2 rounded-lg text-2xl`}>{cats[k].i}</div>
<h3 className="font-semibold">{cats[k].n}</h3>
<span className="ml-auto text-sm text-gray-500">{catDocs.length}</span>
</div>
<input type="file" accept=".pdf" multiple onChange={e=>upFile(e,k)} className="block w-full text-sm file:py-2 file:px-4 file:rounded-lg file:border-0 file:bg-blue-50 file:text-blue-700 mb-3"/>
{catDocs.length>0&&(
<div className="space-y-2">
{catDocs.map(d=>(
<div key={d.id} className="flex justify-between items-center p-2 bg-gray-50 rounded">
<span className="text-sm truncate flex-1">{d.display_name}</span>
<button onClick={()=>delDoc(d.id)} className="text-red-600 text-sm ml-2">Eliminar</button>
</div>
))}
</div>
)}
</div>
)})}
</div>
</div>
)}
</div>
</div>
);
}

const vis=Object.keys(cats).filter(k=>getDocsByCat(k).length>0);

return(
<div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6">
<div className="max-w-4xl mx-auto">
<div className="bg-white rounded-lg shadow-lg p-6 mb-6">
<div className="flex justify-between items-center mb-4">
<div className="flex-1">
<div className="flex items-center gap-3 mb-2">
<h1 className="text-3xl font-bold">Documentos</h1>
<span className="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm font-mono font-bold">{curr.code}</span>
</div>
{curr.passenger_name&&<p className="text-gray-600">ğŸ‘¥ {curr.passenger_name}</p>}
</div>
<div className="flex items-center gap-3">
<img src={logo} className="h-16 w-16 object-contain"/>
<button onClick={()=>setCurr(null)} className="px-3 py-1 bg-gray-200 rounded text-sm">Salir</button>
</div>
</div>

{(curr.destination||curr.start_date)&&(
<div className="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4 mt-4">
<div className="flex flex-wrap gap-4 text-sm">
{curr.destination&&<div className="flex items-center gap-2"><span className="text-xl">ğŸŒ</span><span className="font-medium">{curr.destination}</span></div>}
{curr.start_date&&curr.end_date&&<div className="flex items-center gap-2"><span className="text-xl">ğŸ“…</span><span>{fmt(curr.start_date)} - {fmt(curr.end_date)}</span></div>}
</div>
</div>
)}

{docs.length>0&&(
<div className="mt-4 flex justify-between">
<p className="text-sm text-gray-600">{docs.length} documento{docs.length!==1?'s':''}</p>
<button onClick={downloadAll} className="px-3 py-1 bg-green-600 text-white rounded-lg text-sm">ğŸ“¥ Todos</button>
</div>
)}
</div>

{!vis.length?(
<div className="bg-white rounded-lg shadow-lg p-12 text-center">
<div className="text-6xl mb-4">ğŸ“„</div>
<p className="text-gray-500">Sin documentos</p>
</div>
):(
<div className="space-y-6">
{vis.map(k=>{
const catDocs=getDocsByCat(k);
return(
<div key={k} className="bg-white rounded-lg shadow-lg p-6">
<div className="flex items-center gap-3 mb-4">
<div className={`${cats[k].c} p-3 rounded-lg text-2xl`}>{cats[k].i}</div>
<h2 className="text-xl font-semibold">{cats[k].n}</h2>
</div>
<div className="space-y-3">
{catDocs.map(d=>(
<div key={d.id} className="flex justify-between items-center p-4 bg-gray-50 rounded-lg hover:bg-gray-100">
<div className="flex items-center gap-3 flex-1">
<span className="text-xl">ğŸ“„</span>
<span className="truncate">{d.display_name}</span>
</div>
<button onClick={()=>download(d)} className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">ğŸ“¥ Descargar</button>
</div>
))}
</div>
</div>
)})}
</div>
)}

<div className="mt-8 bg-white rounded-lg shadow-lg p-6 text-center">
<p className="text-gray-600 mb-4 text-sm font-medium">Seguinos</p>
<div className="flex justify-center gap-4">
<a href="https://instagram.com/tripnenjoy" target="_blank" className="flex items-center gap-2 px-3 py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg text-sm">
<svg className="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
@tripnenjoy
</a>
<a href="https://wa.me/5491126092015" target="_blank" className="flex items-center gap-2 px-3 py-2 bg-green-500 text-white rounded-lg text-sm">
<svg className="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767