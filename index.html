<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trip & Enjoy - Portal de Viajes</title>
    <link rel="icon" href="https://i.postimg.cc/WNbxj55s/Favicon-T-E-(2).png">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="module">
        import React, { useState, useEffect } from 'https://esm.sh/react@18';
        import ReactDOM from 'https://esm.sh/react-dom@18/client';
        import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

        const SUPABASE_URL = 'https://txmfjhhjyjjktgluyjzj.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR4bWZqaGhqeWpqa3RnbHV5anpqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgwNzU4ODEsImV4cCI6MjA4MzY1MTg4MX0.Qab1gujJBQDfOxeuP5v5pWYO-x5ARGiOkgTaF5aeVyk';
        const sb = createClient(SUPABASE_URL, SUPABASE_KEY);
        const ADMIN_PASS = 'tripnenjoy2025';

        function App() {
            const [trips, setTrips] = useState([]);
            const [code, setCode] = useState('');
            const [curr, setCurr] = useState(null);
            const [admin, setAdmin] = useState(false);
            const [pass, setPass] = useState('');
            const [auth, setAuth] = useState(false);
            const [logo, setLogo] = useState('https://i.postimg.cc/WNbxj55s/Favicon-T-E-(2).png');
            const [newCode, setNewCode] = useState('');
            const [editInfo, setEditInfo] = useState(false);
            const [loading, setLoading] = useState(true);
            const [docs, setDocs] = useState([]);

            const cats = {
                aereos: { n: 'Vuelos', i: 'âœˆï¸', c: 'bg-blue-500' },
                hoteles: { n: 'Hoteles', i: 'ðŸ¨', c: 'bg-purple-500' },
                transportes: { n: 'Transportes', i: 'ðŸš—', c: 'bg-green-500' },
                traslados: { n: 'Traslados', i: 'ðŸ“', c: 'bg-orange-500' },
                actividades: { n: 'Actividades', i: 'ðŸ§­', c: 'bg-pink-500' },
                circuitos: { n: 'Circuitos', i: 'ðŸ—ºï¸', c: 'bg-indigo-500' },
                seguroMedico: { n: 'Seguro', i: 'ðŸ›¡ï¸', c: 'bg-red-500' },
                otros: { n: 'Otros', i: 'ðŸ“„', c: 'bg-gray-500' }
            };

            const loadTrips = async () => {
                setLoading(true);
                const { data } = await sb.from('trips').select('*').order('created_at', { ascending: false });
                setTrips(data || []);
                setLoading(false);
            };

            const loadDocs = async (tripId) => {
                const { data } = await sb.from('documents').select('*').eq('trip_id', tripId);
                setDocs(data || []);
            };

            const loadLogo = async () => {
                const { data } = await sb.from('config').select('value').eq('key', 'logo').single();
                if (data) setLogo(data.value);
            };

            useEffect(() => { loadTrips(); loadLogo(); }, []);

            const access = () => {
                const c = code.toUpperCase().trim();
                const trip = trips.find(t => t.code === c);
                if (trip) { setCurr(trip); setCode(''); loadDocs(trip.id); } else alert('CÃ³digo invÃ¡lido');
            };

            const login = () => { if (pass === ADMIN_PASS) { setAuth(true); setPass(''); } else alert('ContraseÃ±a incorrecta'); };

            const create = async () => {
                const c = newCode.toUpperCase().trim();
                if (!c) { alert('Ingresa cÃ³digo'); return; }
                if (trips.find(t => t.code === c)) { alert('Ya existe'); return; }
                const { data, error } = await sb.from('trips').insert([{ code: c }]).select().single();
                if (error) { alert('Error: ' + error.message); return; }
                await loadTrips();
                setCurr(data);
                loadDocs(data.id);
                setNewCode('');
            };

            const updateTrip = async (field, value) => {
                await sb.from('trips').update({ [field]: value }).eq('id', curr.id);
                await loadTrips();
                const updated = trips.find(t => t.id === curr.id);
                if (updated) setCurr(updated);
            };

            const delTrip = async (id, c) => {
                if (!confirm(`Â¿Eliminar ${c}?`)) return;
                await sb.from('trips').delete().eq('id', id);
                await loadTrips();
                if (curr?.id === id) setCurr(null);
            };

            const upLogo = async (e) => {
                const f = e.target.files[0];
                if (!f) return;
                const r = new FileReader();
                r.onload = async (ev) => {
                    await sb.from('config').update({ value: ev.target.result }).eq('key', 'logo');
                    setLogo(ev.target.result);
                };
                r.readAsDataURL(f);
            };

            const upFile = async (e, cat) => {
                const fs = Array.from(e.target.files);
                for (const f of fs) {
                    const r = new FileReader();
                    r.onload = async (ev) => {
                        await sb.from('documents').insert([{
                            trip_id: curr.id,
                            category: cat,
                            display_name: f.name.replace('.pdf', ''),
                            file_name: f.name,
                            file_data: ev.target.result
                        }]);
                        await loadDocs(curr.id);
                    };
                    r.readAsDataURL(f);
                }
            };

            const delDoc = async (id) => {
                if (!confirm('Â¿Eliminar?')) return;
                await sb.from('documents').delete().eq('id', id);
                await loadDocs(curr.id);
            };

            const download = (d) => {
                const l = document.createElement('a');
                l.href = d.file_data;
                l.download = d.file_name;
                l.click();
            };

            const downloadAll = () => {
                let t = 0;
                docs.forEach(d => { setTimeout(() => download(d), t); t += 300; });
            };

            const fmt = d => d ? new Date(d).toLocaleDateString('es-ES', { day: '2-digit', month: 'short', year: 'numeric' }) : '';
            const getDocsByCat = (cat) => docs.filter(d => d.category === cat);

            if (loading) return React.createElement('div', { className: 'min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center' },
                React.createElement('div', { className: 'text-center' },
                    React.createElement('div', { className: 'text-6xl mb-4' }, 'â³'),
                    React.createElement('p', { className: 'text-xl text-gray-600' }, 'Cargando...')
                )
            );

            if (!curr && !admin) return React.createElement('div', { className: 'min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-6' },
                React.createElement('div', { className: 'max-w-md w-full' },
                    React.createElement('div', { className: 'bg-white rounded-lg shadow-2xl p-8' },
                        React.createElement('div', { className: 'text-center mb-8' },
                            React.createElement('img', { src: logo, className: 'h-24 w-24 mx-auto mb-4 object-contain' }),
                            React.createElement('h1', { className: 'text-3xl font-bold mb-2' }, 'Trip & Enjoy'),
                            React.createElement('p', { className: 'text-gray-600' }, 'Portal de Documentos')
                        ),
                        React.createElement('div', { className: 'space-y-4' },
                            React.createElement('input', {
                                type: 'text',
                                value: code,
                                onChange: e => setCode(e.target.value.toUpperCase()),
                                onKeyPress: e => e.key === 'Enter' && access(),
                                placeholder: 'CÃ“DIGO DEL VIAJE',
                                className: 'w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:border-blue-500 text-center text-lg font-bold uppercase'
                            }),
                            React.createElement('button', {
                                onClick: access,
                                className: 'w-full px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-bold'
                            }, 'ðŸ”‘ Acceder'),
                            React.createElement('button', {
                                onClick: () => setAdmin(true),
                                className: 'w-full px-6 py-3 bg-gray-200 rounded-lg hover:bg-gray-300 text-sm'
                            }, 'Admin')
                        )
                    ),
                    React.createElement('div', { className: 'mt-6 bg-white rounded-lg shadow-lg p-6 text-center' },
                        React.createElement('p', { className: 'text-gray-600 mb-4 text-sm font-medium' }, 'Seguinos'),
                        React.createElement('div', { className: 'flex justify-center gap-4' },
                            React.createElement('a', {
                                href: 'https://instagram.com/tripnenjoy',
                                target: '_blank',
                                className: 'flex items-center gap-2 px-3 py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg text-sm'
                            }, '@tripnenjoy'),
                            React.createElement('a', {
                                href: 'https://wa.me/5491126092015',
                                target: '_blank',
                                className: 'flex items-center gap-2 px-3 py-2 bg-green-500 text-white rounded-lg text-sm'
                            }, 'WhatsApp')
                        )
                    )
                )
            );

            if (admin && !auth) return React.createElement('div', { className: 'min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-6' },
                React.createElement('div', { className: 'max-w-md w-full bg-white rounded-lg shadow-2xl p-8' },
                    React.createElement('h2', { className: 'text-2xl font-bold text-center mb-6' }, 'Admin'),
                    React.createElement('input', {
                        type: 'password',
                        value: pass,
                        onChange: e => setPass(e.target.value),
                        onKeyPress: e => e.key === 'Enter' && login(),
                        placeholder: 'ContraseÃ±a',
                        className: 'w-full px-4 py-3 border-2 rounded-lg mb-4'
                    }),
                    React.createElement('button', {
                        onClick: login,
                        className: 'w-full px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 mb-3'
                    }, 'Entrar'),
                    React.createElement('button', {
                        onClick: () => setAdmin(false),
                        className: 'w-full px-6 py-3 bg-gray-200 rounded-lg'
                    }, 'Volver')
                )
            );

            if (auth) {
                return React.createElement('div', { className: 'min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6' },
                    React.createElement('div', { className: 'max-w-6xl mx-auto' },
                        React.createElement('div', { className: 'bg-white rounded-lg shadow-lg p-6 mb-6' },
                            React.createElement('div', { className: 'flex justify-between items-center mb-6' },
                                React.createElement('h1', { className: 'text-2xl font-bold' }, 'Panel Admin'),
                                React.createElement('button', {
                                    onClick: () => { setAuth(false); setAdmin(false); setCurr(null); },
                                    className: 'px-4 py-2 bg-gray-600 text-white rounded-lg'
                                }, 'Salir')
                            ),
                            React.createElement('div', { className: 'border rounded-lg p-4 mb-6' },
                                React.createElement('h3', { className: 'text-lg font-semibold mb-3' }, 'ðŸ“¤ Logo'),
                                React.createElement('input', {
                                    type: 'file',
                                    accept: 'image/*',
                                    onChange: upLogo,
                                    className: 'block w-full text-sm'
                                }),
                                React.createElement('img', { src: logo, className: 'h-16 w-16 mt-3 border rounded' })
                            ),
                            React.createElement('div', { className: 'border rounded-lg p-4 mb-6' },
                                React.createElement('h3', { className: 'text-lg font-semibold mb-3' }, 'âž• Crear Viaje'),
                                React.createElement('div', { className: 'flex gap-3' },
                                    React.createElement('input', {
                                        type: 'text',
                                        value: newCode,
                                        onChange: e => setNewCode(e.target.value.toUpperCase()),
                                        onKeyPress: e => e.key === 'Enter' && create(),
                                        placeholder: 'CÃ“DIGO',
                                        className: 'flex-1 px-3 py-2 border rounded uppercase font-bold'
                                    }),
                                    React.createElement('button', {
                                        onClick: create,
                                        className: 'px-6 py-2 bg-green-600 text-white rounded-lg'
                                    }, 'Crear')
                                )
                            ),
                            React.createElement('div', { className: 'border rounded-lg p-4 mb-6' },
                                React.createElement('h3', { className: 'text-lg font-semibold mb-3' }, `Viajes (${trips.length})`),
                                React.createElement('div', { className: 'space-y-2' },
                                    trips.map(t => React.createElement('div', { key: t.id, className: 'flex justify-between items-center p-3 bg-gray-50 rounded-lg' },
                                        React.createElement('div', { className: 'flex items-center gap-3' },
                                            React.createElement('span', { className: 'font-mono font-bold text-lg' }, t.code),
                                            t.destination && React.createElement('span', { className: 'text-sm text-gray-600' }, 'â†’ ' + t.destination)
                                        ),
                                        React.createElement('div', { className: 'flex gap-2' },
                                            React.createElement('button', {
                                                onClick: () => { setCurr(t); loadDocs(t.id); },
                                                className: curr?.id === t.id ? 'px-4 py-2 rounded-lg bg-blue-600 text-white' : 'px-4 py-2 rounded-lg bg-blue-100 text-blue-700'
                                            }, curr?.id === t.id ? 'Editando' : 'Editar'),
                                            React.createElement('button', {
                                                onClick: () => delTrip(t.id, t.code),
                                                className: 'px-3 py-2 bg-red-100 text-red-700 rounded-lg'
                                            }, 'ðŸ—‘ï¸')
                                        )
                                    )),
                                    !trips.length && React.createElement('p', { className: 'text-center text-gray-500 py-4' }, 'Sin viajes')
                                )
                            )
                        ),
                        curr && React.createElement('div', { className: 'bg-white rounded-lg shadow-lg p-6' },
                            React.createElement('div', { className: 'flex justify-between items-center mb-4' },
                                React.createElement('h2', { className: 'text-xl font-bold' }, 'Editando: ' + curr.code),
                                React.createElement('button', {
                                    onClick: () => setEditInfo(!editInfo),
                                    className: 'text-blue-600'
                                }, 'âœï¸ Info')
                            ),
                            editInfo && React.createElement('div', { className: 'border rounded-lg p-4 mb-6 space-y-3' },
                                React.createElement('input', {
                                    type: 'text',
                                    placeholder: 'Nombre pasajero',
                                    value: curr.passenger_name || '',
                                    onChange: e => updateTrip('passenger_name', e.target.value),
                                    className: 'w-full px-3 py-2 border rounded'
                                }),
                                React.createElement('input', {
                                    type: 'text',
                                    placeholder: 'Destino',
                                    value: curr.destination || '',
                                    onChange: e => updateTrip('destination', e.target.value),
                                    className: 'w-full px-3 py-2 border rounded'
                                }),
                                React.createElement('div', { className: 'grid grid-cols-2 gap-3' },
                                    React.createElement('input', {
                                        type: 'date',
                                        value: curr.start_date || '',
                                        onChange: e => updateTrip('start_date', e.target.value),
                                        className: 'px-3 py-2 border rounded'
                                    }),
                                    React.createElement('input', {
                                        type: 'date',
                                        value: curr.end_date || '',
                                        onChange: e => updateTrip('end_date', e.target.value),
                                        className: 'px-3 py-2 border rounded'
                                    })
                                ),
                                React.createElement('button', {
                                    onClick: () => setEditInfo(false),
                                    className: 'px-4 py-2 bg-green-600 text-white rounded-lg'
                                }, 'Cerrar')
                            ),
                            React.createElement('div', { className: 'space-y-6' },
                                Object.keys(cats).map(k => {
                                    const catDocs = getDocsByCat(k);
                                    return React.createElement('div', { key: k, className: 'border rounded-lg p-4' },
                                        React.createElement('div', { className: 'flex items-center gap-3 mb-3' },
                                            React.createElement('div', { className: `${cats[k].c} p-2 rounded-lg text-2xl` }, cats[k].i),
                                            React.createElement('h3', { className: 'font-semibold' }, cats[k].n),
                                            React.createElement('span', { className: 'ml-auto text-sm text-gray-500' }, catDocs.length)
                                        ),
                                        React.createElement('input', {
                                            type: 'file',
                                            accept: '.pdf',
                                            multiple: true,
                                            onChange: e => upFile(e, k),
                                            className: 'block w-full text-sm mb-3'
                                        }),
                                        catDocs.length > 0 && React.createElement('div', { className: 'space-y-2' },
                                            catDocs.map(d => React.createElement('div', { key: d.id, className: 'flex justify-between items-center p-2 bg-gray-50 rounded' },
                                                React.createElement('span', { className: 'text-sm truncate flex-1' }, d.display_name),
                                                React.createElement('button', {
                                                    onClick: () => delDoc(d.id),
                                                    className: 'text-red-600 text-sm ml-2'
                                                }, 'Eliminar')
                                            ))
                                        )
                                    );
                                })
                            )
                        )
                    )
                );
            }

            const vis = Object.keys(cats).filter(k => getDocsByCat(k).length > 0);

            return React.createElement('div', { className: 'min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6' },
                React.createElement('div', { className: 'max-w-4xl mx-auto' },
                    React.createElement('div', { className: 'bg-white rounded-lg shadow-lg p-6 mb-6' },
                        React.createElement('div', { className: 'flex justify-between items-center mb-4' },
                            React.createElement('div', { className: 'flex-1' },
                                React.createElement('div', { className: 'flex items-center gap-3 mb-2' },
                                    React.createElement('h1', { className: 'text-3xl font-bold' }, 'Documentos'),
                                    React.createElement('span', { className: 'px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm font-mono font-bold' }, curr.code)
                                ),
                                curr.passenger_name && React.createElement('p', { className: 'text-gray-600' }, 'ðŸ‘¥ ' + curr.passenger_name)
                            ),
                            React.createElement('div', { className: 'flex items-center gap-3' },
                                React.createElement('img', { src: logo, className: 'h-16 w-16 object-contain' }),
                                React.createElement('button', {
                                    onClick: () => setCurr(null),
                                    className: 'px-3 py-1 bg-gray-200 rounded text-sm'
                                }, 'Salir')
                            )
                        ),
                        (curr.destination || curr.start_date) && React.createElement('div', { className: 'bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4 mt-4' },
                            React.createElement('div', { className: 'flex flex-wrap gap-4 text-sm' },
                                curr.destination && React.createElement('div', { className: 'flex items-center gap-2' },
                                    React.createElement('span', { className: 'text-xl' }, 'ðŸŒ'),
                                    React.createElement('span', { className: 'font-medium' }, curr.destination)
                                ),
                                curr.start_date && curr.end_date && React.createElement('div', { className: 'flex items-center gap-2' },
                                    React.createElement('span', { className: 'text-xl' }, 'ðŸ“…'),
                                    React.createElement('span', {}, fmt(curr.start_date) + ' - ' + fmt(curr.end_date))
                                )
                            )
                        ),
                        docs.length > 0 && React.createElement('div', { className: 'mt-4 flex justify-between' },
                            React.createElement('p', { className: 'text-sm text-gray-600' }, docs.length + ' documento' + (docs.length !== 1 ? 's' : '')),
                            React.createElement('button', {
                                onClick: downloadAll,
                                className: 'px-3 py-1 bg-green-600 text-white rounded-lg text-sm'
                            }, 'ðŸ“¥ Todos')
                        )
                    ),
                    !vis.length ? React.createElement('div', { className: 'bg-white rounded-lg shadow-lg p-12 text-center' },
                        React.createElement('div', { className: 'text-6xl mb-4' }, 'ðŸ“„'),
                        React.createElement('p', { className: 'text-gray-500' }, 'Sin documentos')
                    ) : React.createElement('div', { className: 'space-y-6' },
                        vis.map(k => {
                            const catDocs = getDocsByCat(k);
                            return React.createElement('div', { key: k, className: 'bg-white rounded-lg shadow-lg p-6' },
                                React.createElement('div', { className: 'flex items-center gap-3 mb-4' },
                                    React.createElement('div', { className: `${cats[k].c} p-3 rounded-lg text-2xl` }, cats[k].i),
                                    React.createElement('h2', { className: 'text-xl font-semibold' }, cats[k].n)
                                ),
                                React.createElement('div', { className: 'space-y-3' },
                                    catDocs.map(d => React.createElement('div', { key: d.id, className: 'flex justify-between items-center p-4 bg-gray-50 rounded-lg hover:bg-gray-100' },
                                        React.createElement('div', { className: 'flex items-center gap-3 flex-1' },
                                            React.createElement('span', { className: 'text-xl' }, 'ðŸ“„'),
                                            React.createElement('span', { className: 'truncate' }, d.display_name)
                                        ),
                                        React.createElement('button', {
                                            onClick: () => download(d),
                                            className: 'px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700'
                                        }, 'ðŸ“¥ Descargar')
                                    ))
                                )
                            );
                        })
                    ),
                    React.createElement('div', { className: 'mt-8 bg-white rounded-lg shadow-lg p-6 text-center' },
                        React.createElement('p', { className: 'text-gray-600 mb-4 text-sm font-medium' }, 'Seguinos'),
                        React.createElement('div', { className: 'flex justify-center gap-4' },
                            React.createElement('a', {
                                href: 'https://instagram.com/tripnenjoy',
                                target: '_blank',
                                className: 'flex items-center gap-2 px-3 py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg text-sm'
                            }, '@tripnenjoy'),
                            React.createElement('a', {
                                href: 'https://wa.me/5491126092015',
                                target: '_blank',
                                className: 'flex items-center gap-2 px-3 py-2 bg-green-500 text-white rounded-lg text-sm'
                            }, 'WhatsApp')
                        )
                    )
                )
            );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(App));
    </script>
</body>
</html>

